<html>
<head>
  <title>MyMarks</title>
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />
  <script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
  <script>
    var MM = {
      bookmarks: {},
      parseBookmarks: function(data){
        var Foxmarks = {BookmarkManager: {}}
        eval(eval(data));
        MM.bookmarks = Foxmarks.BookmarkManager.bookmarks;
      },

      displayBookmarks: function(bookmarks){
        var $list = $('#bookmark_list');
        $list.empty();
        $.each(bookmarks, function(i,node){
          var li = $('<li>')
          li.append(MM.buildBookmark(node))
          $list.append(li)
          $list.listview("refresh");
        })
      },

      buildBookmark: function(node){
        var a = $('<a>')
        a.text(node.text)
        if(node.leaf){
          // simple link
          a.attr('href', node.href)
        } else {
          // folder
          a.click(function(){
            MM.displayBookmarks(node.children)
            return false;
          })
        }
        return a;
      }
    };

    $(function(){
      $('#login').submit(function(){
        var url = '/bookmarks?' + $(this).serialize();
        $.get(url).success(function(data){
          MM.parseBookmarks(data)
          $.mobile.changePage('#bookmarks');
          MM.displayBookmarks(MM.bookmarks);
        }).error(function(){
          alert("Error downloading bookmarks. Username/password wrong?")
        });
        return false;
      });
    })
  </script>
</head>

<body>
<div data-role="page" id="index">
  <div data-role="header">
    <h1>MyMarks</h1>
  </div>
  <div data-role="content">
    Load your bookmarks by entering your XMarks username/password.
    <form method="post" id="login">
      <input type="text" name="username" placeholder="xmarks username"/>
      <input type="password" name="password" placeholder="xmarks password"/>
      <input type="submit" value="Get My Bookmarks!"/>
    </form>
  </div>
</div>

<div data-role="page" id="bookmarks">
  <div data-role="header">
    <a href="#index" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>
    <h1>MyMarks</h1>
  </div>
  <div data-role="content">
    <ul data-role="listview" id="bookmark_list">
    </ul>
  </div>
</div>

</body>
</html>
